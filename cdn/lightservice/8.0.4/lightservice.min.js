/**
 * lightservice - Simple and convinient interface for service consumption
 * @version v8.0.4
 * @link https://github.com/contactsamie/LightService
 * @license MIT
 * @license Samuel Bamgboye <contactsamie@gmail.com> 
 */
var light="undefined"==typeof light?function(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var n={};n.getCurrentContext=function(e,t,r){var i=r?JSON.parse(JSON.stringify({data:r})).data:r,a={event:n.systemServices,service:E(),arg:t,system:n.system,store:n._STORE_[e].api(i)};return a},n.forbiddenNames={result:!0,service:!0,handle:!0,on:!0,before:!0,after:!0,error:!0,success:!0},n.expectNoForbiddenName=function(e){if(n.forbiddenNames[e])throw"You cannot use the name '"+e+"'"},n.registry={service:{},handle:{},scripts:{}},n.isRegistered=function(e){return n.registry.service[e]||n.registry.handle[e]?!0:!1},n.generateUniqueSystemName=function(e){e=e||"";var t=(e+"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx").replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)});return n.isRegistered(t)?n.generateUniqueSystemName(e):t},n.$setState=function(e,t,r){n._STORE_[e].ref[t]={data:r},n._STORE_[e].store[t]=JSON.stringify(n._STORE_[e].ref[t])},n.$getState=function(e){var t=n._STORE_[e];return t&&(n._STORE_[e].store||{})},n.storeFactory=function(e){n._STORE_[e]={store:{},ref:{},api:function(t){return t&&(n._STORE_[e].store=t),{get:function(t){var r=n.$getState(e)[t];return r?JSON.parse(r).data:r},set:function(t,r){n.$setState(e,t,r)},getRef:function(t){return n._STORE_[e].ref[t]=n._STORE_[e].ref[t]||{},n._STORE_[e].ref[t].data}}}}},n.burnThread=function(e){for(var n=(new Date).getTime()+1e3*e;(new Date).getTime()<=n;);},n.loadScript=function(e,t){t?n.loadScriptAsync(e,t):n.loadScriptSync(e)},n.loadScriptAsync=function(e,n){if(!document)throw"Cannot load script : no document";var t=document.createElement("script");t.src=e,t.onload="function"==typeof n?n:function(){},document.getElementsByTagName("head")[0].appendChild(t)},n.loadScriptSync=function(e){if(!document)throw"Cannot load script : no document";var n=r();n.open("GET",e,!1),n.send("");var t=document.createElement("script");t.type="text/javascript",t.text=n.responseText,document.getElementsByTagName("head")[0].appendChild(t)},n.track={record:function(e){if(e.methodName!==n.DEFAULT_HANDLE_NAME){var t={dataType:e.entranceOrExit,methodType:e.serviceOrHandleMethodName,methodName:e.methodName,time:Date.now?Date.now():(new Date).getTime(),isFirst:e.isFirstCallInServiceRun,isLast:e.isLastCallInServiceRun,data:e.argumentOrReturnData,isTest:e.isTest||!1,info:e.info,infoType:e.infoType,link:"function"==typeof e.link?e.link.toString():e.link,store:n.$getState(e.methodName),event:e.event,eventType:e.eventType},r=JSON.stringify(t);n.recordServices&&(n.recordServices=!1,y[n.systemEventName.onSystemRecordEvent].send(r),n.recordServices=!0),e.serviceOrHandleMethodName===n.serviceTag&&(n.systemServices[e.methodName][n.serviceEventName[e.eventType]].send(r),(e.eventType===n.serviceEventName.error||e.eventType===n.serviceEventName.success)&&n.systemServices[e.methodName][n.serviceEventName[n.serviceEventName.after]].send(r)),y[e.event].send(r),y[n.systemEventName.onSystemEvent].send(r)}}},n.utility={execSurpressError:function(e,n,t,r){if("function"==typeof e)try{e(n,t,r)}catch(i){console.error("SUPRESSED ERROR : "+i)}},tryCatch:function(e,t,r,i){try{var a=t();n.utility.execSurpressError(function(){r(a,e)},null,e,"trying-service")}catch(s){n.utility.execSurpressError(function(){i(s,e)},s,e,"service-throws")}}},n.messageReceivers={},n.send=function(e,t){n.messageReceivers[e]=n.messageReceivers[e]||[];for(var r=n.messageReceivers[e].length,i=0;r>i;i++){var a=n.messageReceivers[e][i];y(function(){this.service[a.link](t)})}},n.receive=function(e,t){n.messageReceivers[e]=n.messageReceivers[e]||[];var r={message:e};r.link=y.service(n.generateUniqueSystemName(),t),n.messageReceivers[e].push(r)};var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=function(){for(var e=!1,n=0;n<t.length;n++){try{e=t[n]()}catch(r){continue}break}return e},i=function(e,t){return i.ref=i.ref||0,i.ref++,n.eventSubscribers[e]=n.eventSubscribers[e]||{},n.eventSubscribers[e].sub=n.eventSubscribers[e].sub||[],n.eventSubscribers[e].sub.push({service:t,ref:i.ref}),i.ref},a=function(e,t){n.eventSubscribers[e]=n.eventSubscribers[e]||{},n.eventSubscribers[e].sub=n.eventSubscribers[e].sub||[],n.eventSubscribers[e].send=n.eventSubscribers[e].send||function(r,i,a){for(var s=e,o=n.eventSubscribers[s].sub.length,c=0;o>c;c++){var u=n.eventSubscribers[s].sub[c],v={index:c,notificationType:a};t(u,r,i,v)}}},s=function(e){return a(e,function(e,t,r,i){n.utility.tryCatch(r,function(){return e.service()},function(){},function(){n.utility.execSurpressError(e.service.error,t,r,i)})})},o=function(e,n,t){e[n]=function(e){i(t,e)},e.receive=e.receive||function(n,t){e[n](t)}},c=function(e,n,t){o(e,n,t),a(t,function(e,n,t,r){if(e&&"function"==typeof e.service)try{e.service(n,t,r)}catch(i){}})},u=function(e,t,r){o(e,t,r),e[t].forEachSubscriber=e[t].forEachSubscriber||function(e){for(var t=n.eventSubscribers[r].sub.length,i=0;t>i;i++){var a=n.eventSubscribers[r].sub[i];e&&e(a)}},s(r),e[t].send=n.eventSubscribers[r].send},v=function(e,t,r){c(e,t,r+"."+t),e[t].send=n.eventSubscribers[r+"."+t].send},m=function(e,t,r,i,a){var s=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[i]&&n._TEST_OBJECTS_[i].handleName,o=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[i]&&n._TEST_OBJECTS_[i].handle;return n.track.record({entranceOrExit:n.entranceTag,serviceOrHandleMethodName:n.handleTag,methodName:s,argumentOrReturnData:i,info:a,infoType:n.serviceArgTag,isTest:!0,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:o,event:n.systemEventName.beforeHandleRun,eventType:n.serviceEventName.before}),tmpDefinition=o.call(n.getCurrentContext(i,r),r),n.track.record({entranceOrExit:n.exitTag,serviceOrHandleMethodName:n.handleTag,methodName:s,argumentOrReturnData:i,info:n.unknownTag,infoType:n.unknownTag,isTest:!0,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:o,event:n.systemEventName.afterHandleRun,eventType:n.serviceEventName.after}),tmpDefinition},f=function(e,t,r,i,a,s,o,c){c&&(r=c);for(var u=!1,v=n.handles.length,m=0;v>m;m++){var f=n.handles[m];if(u=r&&f.name===r){n.track.record({entranceOrExit:n.entranceTag,serviceOrHandleMethodName:n.handleTag,methodName:r,argumentOrReturnData:a,info:s,infoType:n.serviceArgTag,isTest:!1,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:o||f.definition,event:n.systemEventName.beforeHandleRun,eventType:n.serviceEventName.before}),tmpDefinition=(o||f.definition).call(n.getCurrentContext(r,i),i),n.track.record({entranceOrExit:n.exitTag,serviceOrHandleMethodName:n.handleTag,methodName:r,argumentOrReturnData:a,info:n.unknownTag,infoType:n.unknownTag,isTest:!1,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:o||f.definition,event:n.systemEventName.afterHandleRun,eventType:n.serviceEventName.after});break}}return tmpDefinition},d=function(e,t,r,i,a,s){var o,c=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[a]&&n._TEST_OBJECTS_[a].handleName,u=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[a]&&n._TEST_OBJECTS_[a].handle;return o=u&&!c?m(e,t,i,a,s):f(e,t,r,i,a,s,u,c)},l=function(t,r,i,a,s,o){n._TEST_OBJECTS_&&n._TEST_OBJECTS_[s]&&n._TEST_OBJECTS_[s].service&&(i=n._TEST_OBJECTS_[s].handleNames||i,a=n._TEST_OBJECTS_[s].service||a),i=e(i)?i:i?[i]:[];var c,u=i.length;c=o;for(var v=0;u>v;v++){var m=i[v],f=d(t,r,m,a,s,c);if("function"!=typeof f){var l="Cannot process service or handle '"+s+"' ";throw l+=f?"'"+m+"' service handle must return a function":"no matching service handle  exists ",console.error(l),l}c=f.call(n.getCurrentContext(s,c),c)}return c},S=function(e,t,r,i,a){return u(t,n.serviceEventName.before,a+"."+n.serviceEventName.before),u(t,n.serviceEventName.after,a+"."+n.serviceEventName.after),u(t,n.serviceEventName.error,a+"."+n.serviceEventName.error),u(t,n.serviceEventName.success,a+"."+n.serviceEventName.success),function(s,o){var c={};c.arg=s;var u;return e.callerContext=o,n.utility.tryCatch(e,function(){n.track.record({entranceOrExit:n.entranceTag,serviceOrHandleMethodName:n.serviceTag,methodName:a,argumentOrReturnData:c.arg,info:r,infoType:n.handleTag,isTest:!1,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:i,event:n.systemEventName.beforeServiceRun,eventType:n.serviceEventName.before})},function(e){},function(e){}),n.utility.tryCatch(e,function(){return u=l(e,t,r,i,a,c.arg)},function(e){n.track.record({entranceOrExit:n.exitTag,serviceOrHandleMethodName:n.serviceTag,methodName:a,argumentOrReturnData:e,info:"event:success",infoType:n.eventTag,isTest:!1,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:i,event:n.systemEventName.onServiceSuccess,eventType:n.serviceEventName.success})},function(e){n.track.record({entranceOrExit:n.exitTag,serviceOrHandleMethodName:n.serviceTag,methodName:a,argumentOrReturnData:e,info:"event:error",infoType:n.eventTag,isTest:!1,isFirstCallInServiceRun:n.unknownTag,isLastCallInServiceRun:n.unknownTag,link:i,event:n.systemEventName.onServiceError,eventType:n.serviceEventName.error})}),u}},T=function(t,r,i){var a="service_";if(0==arguments.length||arguments.length>3)throw"Cannot create service : problem with service definition";if(1==arguments.length){if("function"!=typeof t)return n.registry.scripts[t]?{load:function(e){e&&y(e)}}:(n.registry.scripts[t]=!0,{load:function(e){n.loadScript(t,e&&function(){y(e)})}});i=t,t=n.generateUniqueSystemName(a),r=n.DEFAULT_HANDLE_NAME}if(2==arguments.length){if("function"!=typeof r)throw"service definition has to be a function";i=r,e(t)?(r=t,t=n.generateUniqueSystemName(a)):r=n.DEFAULT_HANDLE_NAME}if(n.isRegistered(t))throw"Unable to create service with name '"+t+"'.Name already exists in registry";n.expectNoForbiddenName(t);var s=i,o={},c=function(e){return c.redefinition(e)};return c.redefinition=S(o,c,r,s,t),c.me=t,n.systemServices[t]=c,n.registry.service[t]={},n.storeFactory(t),t},g=function(e,n,t){for(var r in e)n(r);t()},E=function(e){E.totalChain=E.totalChain||0;var t={},r=void 0;t.result=function(){var e=r;return r=void 0,e};var i=function(e){t[e]=function(e){return function(i){var a={};a.previousOrMostCurrentResultToBePassedToTheNextActor=arguments.length?i:r;var s=JSON.parse(JSON.stringify(a)).previousOrMostCurrentResultToBePassedToTheNextActor;return r=n.systemServices[e](s),t}}(e)};if(e)g(n.systemServices,i,function(){e(t)});else for(var a in n.systemServices)i(a);return t.merge=function(e){var n;if(r)for(var i in r)n=n||{},n[i]=r[i];if(e)for(var i in e)n=n||{},n[i]=e[i];return r=n,t},t},y=function(e){E(function(t){"function"==typeof e&&e.call(n.getCurrentContext(n._INTERNAL_SCOPE_NAME,t),t)})};y.startService=function(e){y(e)},y.handle=function(e,t){var r="handle_";if(0==arguments.length||arguments.length>2)throw"Cannot create handle : problem with handle definition";if(1==arguments.length){if("function"!=typeof e)throw"handle definition has to be a function";t=e,e=n.generateUniqueSystemName(r)}if(n.isRegistered(e))throw"Unable to create handle with name '"+e+"'.Name already exists in registry";return n.expectNoForbiddenName(e),n.registry.handle[e]={},n.handles.push({name:e,definition:t}),n.storeFactory(e),e},y.advanced={test:function(e,t){n._TEST_OBJECTS_=e,t.call(n.getCurrentContext(n._INTERNAL_SCOPE_NAME,E()),E()),n._TEST_OBJECTS_=void 0},play:function(e,t,r){t=t||0,r=r||n.track.records.length-1,y(function(i){for(var a=i,s=t;r>=s;s++){var o=e&&(e||[])[s]||[];if(!o)throw"unable to find service to play service";o.methodType===n.serviceTag&&o.dataType===n.entranceTag&&(a=s===t?a[o.methodName].call(n.getCurrentContext(o.methodName,o.data,o.store),o.data):a[o.methodName]())}a.result()})}},"undefined"==typeof Immutable?n.Immutable={List:function(e){return this.Map(e)},Map:function(e){var t=n.generateUniqueSystemName("immu"),r={data:e};return n.ImmutableStore[t]=JSON.stringify(r),{get:function(e){var r=JSON.parse(n.ImmutableStore[t]);return r.data[e]},set:function(e,r){var i=JSON.parse(n.ImmutableStore[t]);i.data[e]=r;var a=JSON.parse(JSON.stringify(i)).data;return n.Immutable.Map(a)}}}}:n.Immutable=Immutable,n.copy=function(e){n.Immutable.Map({data:e}).get("data")};var N=function(){n.entranceTag="argument",n.exitTag="result",n.serviceTag="service",n.handleTag="handle",n.eventTag="event",n.unknownTag="unknown",n.systemEventName={beforeServiceRun:"beforeServiceRun",afterServiceRun:"afterServiceRun",beforeHandleRun:"beforeHandleRun",afterHandleRun:"afterHandleRun",onServiceError:"onServiceError",onServiceSuccess:"onServiceSuccess",onSystemEvent:"onSystemEvent",onSystemRecordEvent:"onSystemRecordEvent"},n.serviceEventName={before:"before",after:"after",error:"error",success:"success"},n._TEST_OBJECTS_={},n.systemServices={},n.ImmutableStore={},n._STORE_={},n.eventSubscribers={},n.handles=[],n._INTERNAL_SCOPE_NAME=n.generateUniqueSystemName(),n.storeFactory(n._INTERNAL_SCOPE_NAME),n.DEFAULT_HANDLE_NAME=n.generateUniqueSystemName(),y.version="6.0.0",y.service=T,y.Immutable=n.Immutable,y.send=n.send,y.receive=n.receive,v(y,n.systemEventName.onSystemEvent,n.generateUniqueSystemName()),v(y,n.systemEventName.onSystemRecordEvent,n.generateUniqueSystemName()),v(y,n.systemEventName.beforeServiceRun,n.generateUniqueSystemName()),v(y,n.systemEventName.afterServiceRun,n.generateUniqueSystemName()),v(y,n.systemEventName.beforeHandleRun,n.generateUniqueSystemName()),v(y,n.systemEventName.afterHandleRun,n.generateUniqueSystemName()),v(y,n.systemEventName.onServiceError,n.generateUniqueSystemName()),v(y,n.systemEventName.onServiceSuccess,n.generateUniqueSystemName()),y.handle(n.DEFAULT_HANDLE_NAME,function(e){return e})};return N(),n.system={startRecording:function(){n.recordServices=!0},stopRecording:function(){n.recordServices=!1}},y.ServiceDataList=function(e,n){return y.service(e,function(e){var t=this.store.get("records")||n||[];return e&&(t.push(e),this.store.set("records",t)),t})},y.ServiceDataObject=function(e,n){return y.service(e,function(e){var t=this.store.get("record");return e?(this.store.set("record",e),e):("undefined"==typeof t&&(t=n,this.store.set("record",t)),t)})},y}():console.log("light script already exists");"undefined"!=typeof module&&"exports"in module&&(module.exports=light),"function"==typeof define&&define.amd&&define("light",[],function(){return light});