/**
 * lightservice - Simple and convinient interface for service consumption
 * @version v8.0.0
 * @link https://github.com/contactsamie/LightService
 * @license MIT
 * @license Samuel Bamgboye <contactsamie@gmail.com> 
 */
var light="undefined"==typeof light?function(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var t={};t.getCurrentContext=function(e,n,r){var i=r?JSON.parse(JSON.stringify({data:r})).data:r,a={event:t.systemServices,service:E(),arg:n,system:t.system,state:t._STATE_[e].api(i)};return a},t.forbiddenNames={result:!0,service:!0,handle:!0,on:!0,before:!0,after:!0,error:!0,success:!0},t.expectNoForbiddenName=function(e){if(t.forbiddenNames[e])throw"You cannot use the name '"+e+"'"},t.registry={service:{},handle:{},scripts:{}},t.isRegistered=function(e){return t.registry.service[e]||t.registry.handle[e]?!0:!1},t.generateUniqueSystemName=function(e){e=e||"";var n=(e+"_xxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx").replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return t.isRegistered(n)?t.generateUniqueSystemName(e):n},t.$setState=function(e,n,r){t._STATE_[e].ref[n]={data:r},t._STATE_[e].state[n]=JSON.stringify(t._STATE_[e].ref[n])},t.$getState=function(e){var n=t._STATE_[e];return n&&(t._STATE_[e].state||{})},t.stateFactory=function(e){t._STATE_[e]={state:{},ref:{},api:function(n){return n&&(t._STATE_[e].state=n),{get:function(n){var r=t.$getState(e)[n];return r?JSON.parse(r).data:r},set:function(n,r){t.$setState(e,n,r)},getRef:function(n){return t._STATE_[e].ref[n]=t._STATE_[e].ref[n]||{},t._STATE_[e].ref[n].data}}}}},t.burnThread=function(e){for(var t=(new Date).getTime()+1e3*e;(new Date).getTime()<=t;);},t.loadScript=function(e,n){n?t.loadScriptAsync(e,n):t.loadScriptSync(e)},t.loadScriptAsync=function(e,t){if(!document)throw"Cannot load script : no document";var n=document.createElement("script");n.src=e,n.onload="function"==typeof t?t:function(){},document.getElementsByTagName("head")[0].appendChild(n)},t.loadScriptSync=function(e){if(!document)throw"Cannot load script : no document";var t=r();t.open("GET",e,!1),t.send("");var n=document.createElement("script");n.type="text/javascript",n.text=t.responseText,document.getElementsByTagName("head")[0].appendChild(n)},t.track={record:function(e){if(e.methodName!==t.DEFAULT_HANDLE_NAME){var n={dataType:e.entranceOrExit,methodType:e.serviceOrHandleMethodName,methodName:e.methodName,time:Date.now?Date.now():(new Date).getTime(),isFirst:e.isFirstCallInServiceRun,isLast:e.isLastCallInServiceRun,data:e.argumentOrReturnData,isTest:e.isTest||!1,info:e.info,infoType:e.infoType,link:"function"==typeof e.link?e.link.toString():e.link,state:t.$getState(e.methodName),event:e.event,eventType:e.eventType},r=JSON.stringify(n);t.recordServices&&(t.recordServices=!1,y[t.systemEventName.onSystemRecordEvent].send(r),t.recordServices=!0),e.serviceOrHandleMethodName===t.serviceTag&&(t.systemServices[e.methodName][t.serviceEventName[e.eventType]].send(r),(e.eventType===t.serviceEventName.error||e.eventType===t.serviceEventName.success)&&t.systemServices[e.methodName][t.serviceEventName[t.serviceEventName.after]].send(r)),y[e.event].send(r),y[t.systemEventName.onSystemEvent].send(r)}}},t.utility={execSurpressError:function(e,t,n,r){if("function"==typeof e)try{e(t,n,r)}catch(i){console.error("SUPRESSED ERROR : "+i)}},tryCatch:function(e,n,r,i){try{var a=n();t.utility.execSurpressError(function(){r(a,e)},null,e,"trying-service")}catch(s){t.utility.execSurpressError(function(){i(s,e)},s,e,"service-throws")}}},t.messageReceivers={},t.send=function(e,n){t.messageReceivers[e]=t.messageReceivers[e]||[];for(var r=t.messageReceivers[e].length,i=0;r>i;i++){var a=t.messageReceivers[e][i];y(function(){this.service[a.link](n)})}},t.receive=function(e,n){t.messageReceivers[e]=t.messageReceivers[e]||[];var r={message:e};r.link=y.service(t.generateUniqueSystemName(),n),t.messageReceivers[e].push(r)};var n=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=function(){for(var e=!1,t=0;t<n.length;t++){try{e=n[t]()}catch(r){continue}break}return e},i=function(e,n){return i.ref=i.ref||0,i.ref++,t.eventSubscribers[e]=t.eventSubscribers[e]||{},t.eventSubscribers[e].sub=t.eventSubscribers[e].sub||[],t.eventSubscribers[e].sub.push({service:n,ref:i.ref}),i.ref},a=function(e,n){t.eventSubscribers[e]=t.eventSubscribers[e]||{},t.eventSubscribers[e].sub=t.eventSubscribers[e].sub||[],t.eventSubscribers[e].send=t.eventSubscribers[e].send||function(r,i,a){for(var s=e,c=t.eventSubscribers[s].sub.length,o=0;c>o;o++){var u=t.eventSubscribers[s].sub[o],v={index:o,notificationType:a};n(u,r,i,v)}}},s=function(e){return a(e,function(e,n,r,i){t.utility.tryCatch(r,function(){return e.service()},function(){},function(){t.utility.execSurpressError(e.service.error,n,r,i)})})},c=function(e,t,n){e[t]=function(e){i(n,e)},e.receive=e.receive||function(t,n){e[t](n)}},o=function(e,t,n){c(e,t,n),a(n,function(e,t,n,r){if(e&&"function"==typeof e.service)try{e.service(t,n,r)}catch(i){}})},u=function(e,n,r){c(e,n,r),e[n].forEachSubscriber=e[n].forEachSubscriber||function(e){for(var n=t.eventSubscribers[r].sub.length,i=0;n>i;i++){var a=t.eventSubscribers[r].sub[i];e&&e(a)}},s(r),e[n].send=t.eventSubscribers[r].send},v=function(e,n,r){o(e,n,r+"."+n),e[n].send=t.eventSubscribers[r+"."+n].send},m=function(e,n,r,i,a){var s=t._TEST_OBJECTS_&&t._TEST_OBJECTS_[i]&&t._TEST_OBJECTS_[i].handleName,c=t._TEST_OBJECTS_&&t._TEST_OBJECTS_[i]&&t._TEST_OBJECTS_[i].handle;return t.track.record({entranceOrExit:t.entranceTag,serviceOrHandleMethodName:t.handleTag,methodName:s,argumentOrReturnData:i,info:a,infoType:t.serviceArgTag,isTest:!0,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:c,event:t.systemEventName.beforeHandleRun,eventType:t.serviceEventName.before}),tmpDefinition=c.call(t.getCurrentContext(i,r),r),t.track.record({entranceOrExit:t.exitTag,serviceOrHandleMethodName:t.handleTag,methodName:s,argumentOrReturnData:i,info:t.unknownTag,infoType:t.unknownTag,isTest:!0,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:c,event:t.systemEventName.afterHandleRun,eventType:t.serviceEventName.after}),tmpDefinition},f=function(e,n,r,i,a,s,c,o){o&&(r=o);for(var u=!1,v=t.handles.length,m=0;v>m;m++){var f=t.handles[m];if(u=r&&f.name===r){t.track.record({entranceOrExit:t.entranceTag,serviceOrHandleMethodName:t.handleTag,methodName:r,argumentOrReturnData:a,info:s,infoType:t.serviceArgTag,isTest:!1,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:c||f.definition,event:t.systemEventName.beforeHandleRun,eventType:t.serviceEventName.before}),tmpDefinition=(c||f.definition).call(t.getCurrentContext(r,i),i),t.track.record({entranceOrExit:t.exitTag,serviceOrHandleMethodName:t.handleTag,methodName:r,argumentOrReturnData:a,info:t.unknownTag,infoType:t.unknownTag,isTest:!1,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:c||f.definition,event:t.systemEventName.afterHandleRun,eventType:t.serviceEventName.after});break}}return tmpDefinition},d=function(e,n,r,i,a,s){var c,o=t._TEST_OBJECTS_&&t._TEST_OBJECTS_[a]&&t._TEST_OBJECTS_[a].handleName,u=t._TEST_OBJECTS_&&t._TEST_OBJECTS_[a]&&t._TEST_OBJECTS_[a].handle;return c=u&&!o?m(e,n,i,a,s):f(e,n,r,i,a,s,u,o)},l=function(n,r,i,a,s,c){t._TEST_OBJECTS_&&t._TEST_OBJECTS_[s]&&t._TEST_OBJECTS_[s].service&&(i=t._TEST_OBJECTS_[s].handleNames||i,a=t._TEST_OBJECTS_[s].service||a),i=e(i)?i:i?[i]:[];var o,u=i.length;o=c;for(var v=0;u>v;v++){var m=i[v],f=d(n,r,m,a,s,o);if("function"!=typeof f){var l="Cannot process service or handle '"+s+"' ";throw l+=f?"'"+m+"' service handle must return a function":"no matching service handle  exists ",console.error(l),l}o=f.call(t.getCurrentContext(s,o),o)}return o},T=function(e,n,r,i,a){return u(n,t.serviceEventName.before,a+"."+t.serviceEventName.before),u(n,t.serviceEventName.after,a+"."+t.serviceEventName.after),u(n,t.serviceEventName.error,a+"."+t.serviceEventName.error),u(n,t.serviceEventName.success,a+"."+t.serviceEventName.success),function(s,c){var o={};o.arg=s;var u;return e.callerContext=c,t.utility.tryCatch(e,function(){t.track.record({entranceOrExit:t.entranceTag,serviceOrHandleMethodName:t.serviceTag,methodName:a,argumentOrReturnData:o.arg,info:r,infoType:t.handleTag,isTest:!1,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:i,event:t.systemEventName.beforeServiceRun,eventType:t.serviceEventName.before})},function(e){},function(e){}),t.utility.tryCatch(e,function(){return u=l(e,n,r,i,a,o.arg)},function(e){t.track.record({entranceOrExit:t.exitTag,serviceOrHandleMethodName:t.serviceTag,methodName:a,argumentOrReturnData:e,info:"event:success",infoType:t.eventTag,isTest:!1,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:i,event:t.systemEventName.onServiceSuccess,eventType:t.serviceEventName.success})},function(e){t.track.record({entranceOrExit:t.exitTag,serviceOrHandleMethodName:t.serviceTag,methodName:a,argumentOrReturnData:e,info:"event:error",infoType:t.eventTag,isTest:!1,isFirstCallInServiceRun:t.unknownTag,isLastCallInServiceRun:t.unknownTag,link:i,event:t.systemEventName.onServiceError,eventType:t.serviceEventName.error})}),u}},S=function(n,r,i){var a="service_";if(0==arguments.length||arguments.length>3)throw"Cannot create service : problem with service definition";if(1==arguments.length){if("function"!=typeof n)return t.registry.scripts[n]?{load:function(e){e&&y(e)}}:(t.registry.scripts[n]=!0,{load:function(e){t.loadScript(n,e&&function(){y(e)})}});i=n,n=t.generateUniqueSystemName(a),r=t.DEFAULT_HANDLE_NAME}if(2==arguments.length){if("function"!=typeof r)throw"service definition has to be a function";i=r,e(n)?(r=n,n=t.generateUniqueSystemName(a)):r=t.DEFAULT_HANDLE_NAME}if(t.isRegistered(n))throw"Unable to create service with name '"+n+"'.Name already exists in registry";t.expectNoForbiddenName(n);var s=i,c={},o=function(e){return o.redefinition(e)};return o.redefinition=T(c,o,r,s,n),o.me=n,t.systemServices[n]=o,t.registry.service[n]={},t.stateFactory(n),n},g=function(e,t,n){for(var r in e)t(r);n()},E=function(e){E.totalChain=E.totalChain||0;var n={},r=void 0;n.result=function(){var e=r;return r=void 0,e};var i=function(e){n[e]=function(e){return function(i){var a={};a.previousOrMostCurrentResultToBePassedToTheNextActor=arguments.length?i:r;var s=JSON.parse(JSON.stringify(a)).previousOrMostCurrentResultToBePassedToTheNextActor;return r=t.systemServices[e](s),n}}(e)};if(e)g(t.systemServices,i,function(){e(n)});else for(var a in t.systemServices)i(a);return n.merge=function(e){var t;if(r)for(var i in r)t=t||{},t[i]=r[i];if(e)for(var i in e)t=t||{},t[i]=e[i];return r=t,n},n},y=function(e){E(function(n){"function"==typeof e&&e.call(t.getCurrentContext(t._INTERNAL_SCOPE_NAME,n),n)})};y.startService=function(e){y(e)},y.handle=function(e,n){var r="handle_";if(0==arguments.length||arguments.length>2)throw"Cannot create handle : problem with handle definition";if(1==arguments.length){if("function"!=typeof e)throw"handle definition has to be a function";n=e,e=t.generateUniqueSystemName(r)}if(t.isRegistered(e))throw"Unable to create handle with name '"+e+"'.Name already exists in registry";return t.expectNoForbiddenName(e),t.registry.handle[e]={},t.handles.push({name:e,definition:n}),t.stateFactory(e),e},y.advanced={test:function(e,n){t._TEST_OBJECTS_=e,n.call(t.getCurrentContext(t._INTERNAL_SCOPE_NAME,E()),E()),t._TEST_OBJECTS_=void 0},play:function(e,n,r){n=n||0,r=r||t.track.records.length-1,y(function(i){for(var a=i,s=n;r>=s;s++){var c=e&&(e||[])[s]||[];if(!c)throw"unable to find service to play service";c.methodType===t.serviceTag&&c.dataType===t.entranceTag&&(a=s===n?a[c.methodName].call(t.getCurrentContext(c.methodName,c.data,c.state),c.data):a[c.methodName]())}a.result()})}},"undefined"==typeof Immutable?t.Immutable={List:function(e){return this.Map(e)},Map:function(e){var n=t.generateUniqueSystemName("immu"),r={data:e};return t.ImmutableStore[n]=JSON.stringify(r),{get:function(e){var r=JSON.parse(t.ImmutableStore[n]);return r.data[e]},set:function(e,r){var i=JSON.parse(t.ImmutableStore[n]);i.data[e]=r;var a=JSON.parse(JSON.stringify(i)).data;return t.Immutable.Map(a)}}}}:t.Immutable=Immutable,t.copy=function(e){t.Immutable.Map({data:e}).get("data")};var N=function(){t.entranceTag="argument",t.exitTag="result",t.serviceTag="service",t.handleTag="handle",t.eventTag="event",t.unknownTag="unknown",t.systemEventName={beforeServiceRun:"beforeServiceRun",afterServiceRun:"afterServiceRun",beforeHandleRun:"beforeHandleRun",afterHandleRun:"afterHandleRun",onServiceError:"onServiceError",onServiceSuccess:"onServiceSuccess",onSystemEvent:"onSystemEvent",onSystemRecordEvent:"onSystemRecordEvent"},t.serviceEventName={before:"before",after:"after",error:"error",success:"success"},t._TEST_OBJECTS_={},t.systemServices={},t.ImmutableStore={},t._STATE_={},t.eventSubscribers={},t.handles=[],t._INTERNAL_SCOPE_NAME=t.generateUniqueSystemName(),t.stateFactory(t._INTERNAL_SCOPE_NAME),t.DEFAULT_HANDLE_NAME=t.generateUniqueSystemName(),y.version="6.0.0",y.service=S,y.Immutable=t.Immutable,y.send=t.send,y.receive=t.receive,v(y,t.systemEventName.onSystemEvent,t.generateUniqueSystemName()),v(y,t.systemEventName.onSystemRecordEvent,t.generateUniqueSystemName()),v(y,t.systemEventName.beforeServiceRun,t.generateUniqueSystemName()),v(y,t.systemEventName.afterServiceRun,t.generateUniqueSystemName()),v(y,t.systemEventName.beforeHandleRun,t.generateUniqueSystemName()),v(y,t.systemEventName.afterHandleRun,t.generateUniqueSystemName()),v(y,t.systemEventName.onServiceError,t.generateUniqueSystemName()),v(y,t.systemEventName.onServiceSuccess,t.generateUniqueSystemName()),y.handle(t.DEFAULT_HANDLE_NAME,function(e){return e})};return N(),t.system={startRecording:function(){t.recordServices=!0},stopRecording:function(){t.recordServices=!1}},y.ServiceDataList=function(e,t){return y.service(e,function(e){var n=this.state.get("records")||t||[];return e&&(n.push(e),this.state.set("records",n)),n})},y.ServiceDataObject=function(e,t){return y.service(e,function(e){var n=this.state.get("record");return e?(this.state.set("record",e),e):("undefined"==typeof n&&(n=t,this.state.set("record",n)),n)})},y}():console.log("light script already exists");"undefined"!=typeof module&&"exports"in module&&(module.exports=light),"function"==typeof define&&define.amd&&define("light",[],function(){return light});