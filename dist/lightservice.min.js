/**
 * lightservice - Simple and convinient interface for service consumption
 * @version v9.0.2
 * @link https://github.com/contactsamie/LightService
 * @license MIT
 * @license Samuel Bamgboye <contactsamie@gmail.com> 
 */
var light="undefined"==typeof light?function(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var n={};n.getCurrentContext=function(e,t,r){var i=r?JSON.parse(JSON.stringify({data:r})).data:r,a={event:n.sysServ,serviceChain:y,service:function(){return y(void 0,!0)},arg:t,system:n.system,store:n.STR[e].api(i)};return a},n.forbiddenNames={result:!0,service:!0,handle:!0,on:!0,before:!0,after:!0,error:!0,success:!0},n.noForbName=function(e){if(n.forbiddenNames[e])throw"You cannot use the name '"+e+"'"},n.rgi={service:{},handle:{},scripts:{}},n.isRegistered=function(e){return n.rgi.service[e]||n.rgi.handle[e]?!0:!1},n.genName=function(e){n.genName.num=n.genName.num||0,n.genName.num++,e=e||"ls";var t=e+n.genName.num;return n.isRegistered(t)?n.genName(e):t},n.$setState=function(e,t,r){n.STR[e].ref[t]={data:r},n.STR[e].store[t]=JSON.stringify(n.STR[e].ref[t])},n.$getState=function(e){var t=n.STR[e];return t&&(n.STR[e].store||{})},n.storeFactory=function(e){n.STR[e]={store:{},ref:{},api:function(t){return t&&(n.STR[e].store=t),{get:function(t){var r=n.$getState(e)[t];return r?JSON.parse(r).data:r},set:function(t,r){n.$setState(e,t,r)},getRef:function(t){return n.STR[e].ref[t]=n.STR[e].ref[t]||{},n.STR[e].ref[t].data}}}}},n.burnThread=function(e){for(var n=(new Date).getTime()+1e3*e;(new Date).getTime()<=n;);},n.loadScript=function(e,t){t?n.loadScriptAsync(e,t):n.loadScriptSync(e)},n.loadScriptAsync=function(e,n){if(!document)throw"Cannot load script : no document";var t=document.createElement("script");t.src=e,t.onload="function"==typeof n?n:function(){},document.getElementsByTagName("head")[0].appendChild(t)},n.loadScriptSync=function(e){if(!document)throw"Cannot load script : no document";var n=r();n.open("GET",e,!1),n.send("");var t=document.createElement("script");t.type="text/javascript",t.text=n.responseText,document.getElementsByTagName("head")[0].appendChild(t)},n.track={record:function(e){if(e.methodName!==n.DEF_HDLNM){var t={dataType:e.dataType,methodType:e.methodType,methodName:e.methodName,time:Date.now?Date.now():(new Date).getTime(),isFirst:e.isFirst,isLast:e.isLast,data:e.data,isTest:e.isTest||!1,info:e.info,infoType:e.infoType,link:"function"==typeof e.link?e.link.toString():e.link,store:n.$getState(e.methodName),event:e.event,eventType:e.eventType},r=JSON.stringify(t);n.recordServices&&(n.recordServices=!1,E[n.sysEvName.onSystemRecordEvent].send(r),n.recordServices=!0),e.methodType===n.serviceTag&&(n.sysServ[e.methodName][n.serviceEventName[e.eventType]].send(r),(e.eventType===n.serviceEventName.error||e.eventType===n.serviceEventName.success)&&n.sysServ[e.methodName][n.serviceEventName[n.serviceEventName.after]].send(r)),E[e.event].send(r),E[n.sysEvName.onSystemEvent].send(r)}}},n.utility={xSupErr:function(e,n,t,r){if("function"==typeof e)try{e(n,t,r)}catch(i){console.error("ERROR : "+i)}},tc:function(e,t,r,i){try{var a=t();n.utility.xSupErr(function(){r(a,e)},null,e,"trying-service")}catch(s){n.utility.xSupErr(function(){console.error("ERROR : "+s),i(s,e)},s,e,"service-throws")}}},n.messageReceivers={},n.send=function(e,t){n.messageReceivers[e]=n.messageReceivers[e]||[];for(var r=n.messageReceivers[e].length,i=0;r>i;i++){var a=n.messageReceivers[e][i];E(function(){this.serviceChain()[a.link](t).result()})}},n.receive=function(e,t){n.messageReceivers[e]=n.messageReceivers[e]||[];var r={message:e};r.link=E.service(n.genName(),n.DEF_HDLNM,t),n.messageReceivers[e].push(r)};var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=function(){for(var e=!1,n=0;n<t.length;n++){try{e=t[n]()}catch(r){continue}break}return e},i=function(e,t){return i.ref=i.ref||0,i.ref++,n.eventSubscribers[e]=n.eventSubscribers[e]||{},n.eventSubscribers[e].sub=n.eventSubscribers[e].sub||[],n.eventSubscribers[e].sub.push({service:t,ref:i.ref}),i.ref},a=function(e,t){n.eventSubscribers[e]=n.eventSubscribers[e]||{},n.eventSubscribers[e].sub=n.eventSubscribers[e].sub||[],n.eventSubscribers[e].send=n.eventSubscribers[e].send||function(r,i,a){for(var s=e,o=n.eventSubscribers[s].sub.length,c=0;o>c;c++){var u=n.eventSubscribers[s].sub[c],v={index:c,notificationType:a};t(u,r,i,v)}}},s=function(e){return a(e,function(e,t,r,i){n.utility.tc(r,function(){return e.service()},function(){},function(){n.utility.xSupErr(e.service().error,t,r,i)})})},o=function(e,n,t){e[n]=function(e){i(t,e)},e.receive=e.receive||function(n,t){e[n](t)}},c=function(e,n,t){o(e,n,t),a(t,function(e,n,t,r){if(e&&"function"==typeof e.service)try{e.service(n,t,r)}catch(i){}})},u=function(e,t,r){o(e,t,r),e[t].forEachSubscriber=e[t].forEachSubscriber||function(e){for(var t=n.eventSubscribers[r].sub.length,i=0;t>i;i++){var a=n.eventSubscribers[r].sub[i];e&&e(a)}},s(r),e[t].send=n.eventSubscribers[r].send},v=function(e,t,r){c(e,t,r+"."+t),e[t].send=n.eventSubscribers[r+"."+t].send},f=function(e,t,r,i,a){var s=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[i]&&n._TEST_OBJECTS_[i].handleName,o=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[i]&&n._TEST_OBJECTS_[i].handle;return n.track.record({dataType:n.entranceTag,methodType:n.handleTag,methodName:s,data:i,info:a,infoType:n.serviceArgTag,isTest:!0,isFirst:n.unknownTag,isLast:n.unknownTag,link:o,event:n.sysEvName.beforeHandleRun,eventType:n.serviceEventName.before}),tmpDefinition=o.call(n.getCurrentContext(i,r),r),n.track.record({dataType:n.exitTag,methodType:n.handleTag,methodName:s,data:i,info:n.unknownTag,infoType:n.unknownTag,isTest:!0,isFirst:n.unknownTag,isLast:n.unknownTag,link:o,event:n.sysEvName.afterHandleRun,eventType:n.serviceEventName.after}),tmpDefinition},d=function(e,t,r,i,a,s,o,c){c&&(r=c);for(var u=!1,v=n.handles.length,f=0;v>f;f++){var d=n.handles[f];if(u=r&&d.name===r){n.track.record({dataType:n.entranceTag,methodType:n.handleTag,methodName:r,data:a,info:s,infoType:n.serviceArgTag,isTest:!1,isFirst:n.unknownTag,isLast:n.unknownTag,link:o||d.definition,event:n.sysEvName.beforeHandleRun,eventType:n.serviceEventName.before}),tmpDefinition=(o||d.definition).call(n.getCurrentContext(r,i),i),n.track.record({dataType:n.exitTag,methodType:n.handleTag,methodName:r,data:a,info:n.unknownTag,infoType:n.unknownTag,isTest:!1,isFirst:n.unknownTag,isLast:n.unknownTag,link:o||d.definition,event:n.sysEvName.afterHandleRun,eventType:n.serviceEventName.after});break}}return tmpDefinition},m=function(e,t,r,i,a,s){var o,c=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[a]&&n._TEST_OBJECTS_[a].handleName,u=n._TEST_OBJECTS_&&n._TEST_OBJECTS_[a]&&n._TEST_OBJECTS_[a].handle;return o=u&&!c?f(e,t,i,a,s):d(e,t,r,i,a,s,u,c)},T=function(t,r,i,a,s,o){n._TEST_OBJECTS_&&n._TEST_OBJECTS_[s]&&n._TEST_OBJECTS_[s].service&&(i=n._TEST_OBJECTS_[s].handleNames||i,a=n._TEST_OBJECTS_[s].service||a),i=e(i)?i:i?[i]:[];var c,u=i.length;c=o;for(var v=0;u>v;v++){var f=i[v],d=m(t,r,f,a,s,c);if("function"!=typeof d){var T="Cannot process service or handle '"+s+"' ";throw T+=d?"'"+f+"' service handle must return a function":"no matching service handle  exists ",console.error(T),T}c=d.call(n.getCurrentContext(s,c),c)}return c},g=function(e,t,r,i,a){return u(t,n.serviceEventName.before,a+"."+n.serviceEventName.before),u(t,n.serviceEventName.after,a+"."+n.serviceEventName.after),u(t,n.serviceEventName.error,a+"."+n.serviceEventName.error),u(t,n.serviceEventName.success,a+"."+n.serviceEventName.success),function(s,o){var c={};c.arg=s;var u;return e.callerContext=o,n.utility.tc(e,function(){n.track.record({dataType:n.entranceTag,methodType:n.serviceTag,methodName:a,data:c.arg,info:r,infoType:n.handleTag,isTest:!1,isFirst:n.unknownTag,isLast:n.unknownTag,link:i,event:n.sysEvName.beforeServiceRun,eventType:n.serviceEventName.before})},function(e){},function(e){}),n.utility.tc(e,function(){return u=T(e,t,r,i,a,c.arg)},function(e){n.track.record({dataType:n.exitTag,methodType:n.serviceTag,methodName:a,data:e,info:"event:success",infoType:n.eventTag,isTest:!1,isFirst:n.unknownTag,isLast:n.unknownTag,link:i,event:n.sysEvName.onServiceSuccess,eventType:n.serviceEventName.success})},function(e){n.track.record({dataType:n.exitTag,methodType:n.serviceTag,methodName:a,data:e,info:"event:error",infoType:n.eventTag,isTest:!1,isFirst:n.unknownTag,isLast:n.unknownTag,link:i,event:n.sysEvName.onServiceError,eventType:n.serviceEventName.error})}),u}},l=function(t,r,i){var a="service_";if(0==arguments.length||arguments.length>3)throw"Cannot create service : problem with service definition";if(1==arguments.length){if("function"!=typeof t)return n.rgi.scripts[t]?{load:function(e){e&&E(e)}}:(n.rgi.scripts[t]=!0,{load:function(e){n.loadScript(t,e&&function(){E(e)})}});i=t,t=n.genName(a),r=n.DEF_HDLNM}if(2==arguments.length){if("function"!=typeof r)throw"service definition has to be a function";i=r,e(t)?(r=t,t=n.genName(a)):r=n.DEF_HDLNM}if(n.isRegistered(t))throw"'"+t+"' already exists";n.noForbName(t);var s=i,o={},c=function(e){return c.redefinition(e)};return c.redefinition=g(o,c,r,s,t),c.me=t,n.sysServ[t]=c,n.rgi.service[t]={},n.storeFactory(t),t},S=function(e,n,t){for(var r in e)n(r);t()},y=function(e,t){y.totalChain=y.totalChain||0;var r={},i=void 0;r.result=function(){var e=i;return i=void 0,e};var a=function(e){r[e]=function(e){return function(a){var s={};s.nextArg=arguments.length?a:i;var o=JSON.parse(JSON.stringify(s)).nextArg;return i=n.sysServ[e](o),t?i:r}}(e)};if(e)S(n.sysServ,a,function(){e(r)});else for(var s in n.sysServ)a(s);return r.merge=function(e){var n;if(i)for(var t in i)n=n||{},n[t]=i[t];if(e)for(var t in e)n=n||{},n[t]=e[t];return i=n,r},r},E=function(e){y(function(t){"function"==typeof e&&e.call(n.getCurrentContext(n._INTERNAL_SCOPE_NAME,t),t)})};E.startService=function(e){E(e)},E.handle=function(e,t){var r="handle_";if(0==arguments.length||arguments.length>2)throw"handle definition error";if(1==arguments.length){if("function"!=typeof e)throw"expects handle to be a function";t=e,e=n.genName(r)}if(n.isRegistered(e))throw" handle '"+e+"' already exists ";return n.noForbName(e),n.rgi.handle[e]={},n.handles.push({name:e,definition:t}),n.storeFactory(e),e},E.advanced={test:function(e,t){n._TEST_OBJECTS_=e,t.call(n.getCurrentContext(n._INTERNAL_SCOPE_NAME,y),y),n._TEST_OBJECTS_=void 0},canPlay:function(e,t){return e===n.serviceTag&&t===n.entranceTag},playService:function(e,t,r){E(function(i){return E.advanced.playServiceChain(i,e,n.serviceTag,t,n.entranceTag,r||{},!1).result()})},playServiceChain:function(e,t,r,i,a,s,o){return E.advanced.canPlay(r,a)&&(e=o?e[t]():e[t].call(n.getCurrentContext(t,i,s),i)),e},play:function(e,n,t){n=n||0,t=t||e.length-1,E(function(r){for(var i=n;t>=i;i++){var a=e&&(e||[])[i]||[];if(!a)throw"no service to play";r=E.advanced.playServiceChain(r,a.methodName,a.methodType,a.data,a.dataType,a.store,i!==n)}r.result()})}},"undefined"==typeof Immutable?n.Immutable={List:function(e){return this.Map(e)},Map:function(e){var t=n.genName("immu"),r={data:e};return n.ImmutableStore[t]=JSON.stringify(r),{get:function(e){var r=JSON.parse(n.ImmutableStore[t]);return r.data[e]},set:function(e,r){var i=JSON.parse(n.ImmutableStore[t]);i.data[e]=r;var a=JSON.parse(JSON.stringify(i)).data;return n.Immutable.Map(a)}}}}:n.Immutable=Immutable,n.copy=function(e){n.Immutable.Map({data:e}).get("data")};var h=function(){n.entranceTag="argument",n.exitTag="result",n.serviceTag="service",n.handleTag="handle",n.eventTag="event",n.unknownTag="unknown",n.sysEvName={beforeServiceRun:"beforeServiceRun",afterServiceRun:"afterServiceRun",beforeHandleRun:"beforeHandleRun",afterHandleRun:"afterHandleRun",onServiceError:"onServiceError",onServiceSuccess:"onServiceSuccess",onSystemEvent:"onSystemEvent",onSystemRecordEvent:"onSystemRecordEvent"},n.serviceEventName={before:"before",after:"after",error:"error",success:"success"},n._TEST_OBJECTS_={},n.sysServ={},n.ImmutableStore={},n.STR={},n.eventSubscribers={},n.handles=[],n._INTERNAL_SCOPE_NAME=n.genName(),n.storeFactory(n._INTERNAL_SCOPE_NAME),n.DEF_HDLNM=n.genName(),E.version="6.0.0",E.service=l,E.Immutable=n.Immutable,E.send=n.send,E.receive=n.receive,v(E,n.sysEvName.onSystemEvent,n.genName()),v(E,n.sysEvName.onSystemRecordEvent,n.genName()),v(E,n.sysEvName.beforeServiceRun,n.genName()),v(E,n.sysEvName.afterServiceRun,n.genName()),v(E,n.sysEvName.beforeHandleRun,n.genName()),v(E,n.sysEvName.afterHandleRun,n.genName()),v(E,n.sysEvName.onServiceError,n.genName()),v(E,n.sysEvName.onServiceSuccess,n.genName()),E.handle(n.DEF_HDLNM,function(e){return e})};return h(),n.system={startRecording:function(){n.recordServices=!0},stopRecording:function(){n.recordServices=!1}},E.ServiceDataList=function(e,n){return E.service(e,function(e){var t=this.store.get("records")||n||[];return e&&(t.push(e),this.store.set("records",t)),t})},E.ServiceDataObject=function(e,n){return E.service(e,function(e){var t=this.store.get("record");return e?(this.store.set("record",e),e):("undefined"==typeof t&&(t=n,this.store.set("record",t)),t)})},E}():console.log("light script already exists");"undefined"!=typeof module&&"exports"in module&&(module.exports=light),"function"==typeof define&&define.amd&&define("light",[],function(){return light});